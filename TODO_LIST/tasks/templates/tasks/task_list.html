{% extends "base.html" %}
{% block title %}Tarefas{% endblock %}

{% block page_title %}Minhas Tarefas{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto p-6 space-y-6">
  <div class="flex items-center justify-between">
    <div>
      <h2 class="text-2xl font-semibold">Minhas Tarefas</h2>
      <p class="text-sm text-gray-500">Olá, {{ user.name }} — aqui estão as tarefas que você participa.</p>
    </div>

    <div class="flex items-center gap-3">
      <a href="{% url 'task-metrics' %}" class="btn bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded">API de Métricas (JSON)</a>
      <a href="{% url 'task-list-api' %}" class="btn bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded">API de Tasks (JSON)</a>
      <a href="{% url 'task-metrics-dashboard' %}" class="btn bg-indigo-100 hover:bg-indigo-200 px-4 py-2 rounded text-indigo-800">Dashboard</a>
      <!-- (task-metrics-dashboard será criado como TemplateView caso prefira render server-side) -->
    </div>
  </div>

  <ul class="space-y-4">
    {% for task in tasks %}
      <li class="bg-white border rounded-md p-4 flex flex-col md:flex-row md:justify-between gap-4">
        <div>
          <a href="{% url 'task-detail' task.pk %}" class="text-lg font-semibold text-indigo-600 hover:underline">{{ task.name }}</a>
          <p class="text-sm text-gray-600 mt-1">Projeto: <a href="{% url 'project-detail' task.project.pk %}" class="text-indigo-600 hover:underline">{{ task.project.name }}</a></p>
          <p class="text-sm text-gray-500 mt-1">Responsável: {{ task.assigned_to.name|default:"—" }}</p>
        </div>

        <div class="flex items-center gap-3">
          <span class="px-3 py-1 rounded-full text-sm font-medium
            {% if task.status == 'completed' %}bg-green-100 text-green-800
            {% elif task.status == 'in_progress' %}bg-yellow-100 text-yellow-800
            {% elif task.status == 'canceled' %}bg-red-100 text-red-800
            {% else %}bg-gray-100 text-gray-800{% endif %}">
            {{ task.get_status_display }}
          </span>

          <span class="px-3 py-1 rounded-full text-sm font-medium
            {% if task.priority == 'HIGH' %}bg-red-100 text-red-800
            {% elif task.priority == 'MEDIUM' %}bg-amber-100 text-amber-800
            {% else %}bg-green-100 text-green-800{% endif %}">
            {{ task.get_priority_display }}
          </span>

          <div class="text-sm text-gray-500">
            <div>Início: {{ task.start_date|date:"d/m/Y" }}</div>
            <div>Fim: {{ task.end_date|date:"d/m/Y" }}</div>
          </div>
        </div>
      </li>
    {% empty %}
      <li class="text-gray-600">Nenhuma tarefa encontrada.</li>
    {% endfor %}
  </ul>
</div>
{% endblock %}
